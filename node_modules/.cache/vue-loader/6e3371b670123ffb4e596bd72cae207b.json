{"remainingRequest":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/src/views/Home/Home.vue?vue&type=style&index=0&id=6d720fe5&scoped=true&lang=css&","dependencies":[{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/src/views/Home/Home.vue","mtime":1622267426000},{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/tarena/yuying/Learning/Vue3/Vue-Project/mall/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi8qIOWKoOS4inNjb3BlZO+8jOihqOekuuW9k+WJjeeahOagt+W8j+WPquS9nOeUqOS6juW9k+WJjee7hOS7tiAqLw0KI2hvbWV7DQogIC8qIHBhZGRpbmc6IDQ0cHggMCA2NHB4OyAqLw0KICAvKiB2aCB2aWV3cG9ydCBoZWlnaHQg6KeG5Y+j6auY5bqm77yMMTAwdmjlsLHmmK/mlbTkuKrop4blj6Ppq5jluqbvvIw1MHZo5pivNTAl55qE6auY5bqmICovDQogIGhlaWdodDogMTAwdmg7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCi5ob21lLW5hdiB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tY29sb3ItdGludCk7DQogICAgY29sb3I6ICNmZmY7DQogICAgLyogcG9zaXRpb246IGZpeGVkOw0KICAgIHJpZ2h0OiAwOw0KICAgIGxlZnQ6IDA7DQogICAgdG9wOiAwOw0KICAgIHotaW5kZXg6IDk7ICovDQogICAgLyogcG9zaXRpb246IHJlbGF0aXZlOyDkuIvpnaLliqDkuoZvdmVyZmxvd++8jOi/memHjOWwseS4jeeUqOiuvue9ruS6hg0KICAgIHotaW5kZXg6IDk7ICovDQp9DQovKiAudGFiLWNvbnRyb2wgew0KICBwb3NpdGlvbjogc3RpY2t5Ow0KICB0b3A6IDQ0cHg7DQogIHotaW5kZXg6IDk7DQp9ICovDQouY29udGVudCB7DQogIC8qIOaWueazleS4gO+8muiuoeeulw0KICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDk4cHgpOyANCiAgb3ZlcmZsb3c6aGlkZGVuOw0KICBtYXJnaW4tdG9wOjQ0cHgqLw0KICBvdmVyZmxvdzogaGlkZGVuOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogNDRweDsNCiAgYm90dG9tOiA0OXB4Ow0KICBsZWZ0OiAwOw0KICByaWdodDogMDsNCn0NCi50YWItY29udHJvbCB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgei1pbmRleDogOTsNCn0NCg=="},{"version":3,"sources":["Home.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Home.vue","sourceRoot":"src/views/Home","sourcesContent":["<template>\r\n    <div id=\"home\">\r\n        <nav-bar class=\"home-nav\">\r\n            <div slot=\"center\">购物街</div>\r\n        </nav-bar>\r\n    <tab-control class=\"tab-control\" \r\n          @tabClick='tabClick'\r\n          :titles='[\"流行\",\"新款\",\"精选\"]'\r\n          v-show=\"isTabFixed\"\r\n          ref=\"tabControl1\"></tab-control>\r\n    <scroll class=\"content\" \r\n          ref=\"scroll\" :probe-type='3' \r\n          @scroll='contentScroll'\r\n          :pull-up-load='true'\r\n          @pullingUp='loadMore'\r\n          :observeImage='true'>\r\n        <home-swiper :banners='banners' @imageLoad='swiperImageLoad'></home-swiper>\r\n        <home-recommend-view :recommends='recommends'></home-recommend-view>\r\n        <feature-view></feature-view>\r\n    <tab-control \r\n            @tabClick='tabClick'\r\n            :titles='[\"流行\",\"新款\",\"精选\"]'\r\n            ref=\"tabControl2\"></tab-control>\r\n        <goods-list :goods='showGoods'></goods-list>\r\n        </scroll>\r\n        <back-top @click.native=\"backTop\" v-show=\"showTop\"></back-top>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n// 分块放置，优雅，方便管理、维护\r\nimport HomeSwiper from './childComps/HomeSwiper' // 导入的组件放一起\r\nimport HomeRecommendView from './childComps/HomeRecommendView'\r\nimport FeatureView from './childComps/FeatureView'\r\n\r\nimport NavBar from 'components/common/navbar/NavBar'\r\nimport TabControl from 'components/content/tabControl/TabControl'\r\nimport GoodsList from 'components/content/goods/GoodsList'\r\nimport Scroll from 'components/common/scroll/Scroll'\r\nimport BackTop from 'components/content/backTop/BackTop'\r\n\r\nimport { \r\n  getHomeMultidata,\r\n  getHomeGoods\r\n} from 'network/home.js'\r\n// import {debounce} from 'common/utils.js' 混入后就不需要再重复引入了\r\nimport {itemListenerMixin} from 'common/mixin.js'\r\nexport default {\r\n  name: 'Home',\r\n  components: {\r\n    NavBar,\r\n    HomeSwiper,\r\n    HomeRecommendView,\r\n    FeatureView,\r\n    TabControl,\r\n    GoodsList,\r\n    Scroll,\r\n    BackTop\r\n  },\r\n  // 混入\r\n  mixins: [itemListenerMixin],\r\n  data () {\r\n    return {\r\n        // result: null\r\n        banners: [],\r\n        recommends: [],\r\n        goods: {\r\n          'pop': {page: 0, list:[]},\r\n          'new': {page: 0, list:[]},\r\n          'sell': {page: 0, list:[]}\r\n        },\r\n        currentType: 'pop',\r\n        showTop: false,\r\n        tabOffsetTop: 0,\r\n        isTabFixed: false,\r\n        saveY: 0\r\n        // itemImgListener: null 通过混入mixins导入\r\n    }\r\n  },\r\n  computed: { // 页面展示处的代码太复杂，可放在计算属性中封装，使上面的代码简化\r\n    showGoods () {\r\n      return this.goods[this.currentType].list\r\n    }\r\n  },\r\n  // destroyed () {\r\n  //   console.log('home destroyed');\r\n  // },\r\n  activated () {\r\n    // 进入时滚动到离开时的位置this.saveY\r\n    this.$refs.scroll.scrollTo(0, this.saveY, 0)\r\n    this.$refs.scroll.refresh() // 进入时再刷新，避免出现小问题\r\n  },\r\n  deactivated () {\r\n    // 保存离开时的位置信息到this.saveY\r\n    this.saveY = this.$refs.scroll.getScrollY()\r\n    // console.log(this.saveY);\r\n    // 2.取消全局事件监听（主页图片加载的监听）因为此时设置了keep-alive，所以离开时调用的是deactivated()\r\n    this.$bus.$off('itemImageLoad',this.itemImgListener)\r\n  },\r\n  created () {\r\n    // 将created钩子中的代码简化，处理主要逻辑，具体的方法实现交给methods\r\n    // 1.请求多个数据\r\n    this.getHomeMultidata()\r\n    // 2.请求商品数据\r\n    this.getHomeGoods('pop')\r\n    this.getHomeGoods('new')\r\n    this.getHomeGoods('sell')\r\n  },\r\n  mounted () {\r\n    // 利用混入，减少重复代码\r\n    // 1.监听item中图片加载完成，刷新防抖函数放到了utils.js中，工具库\r\n    // const refresh = debounce(this.$refs.scroll.refresh,50)\r\n      // 对监听的事件进行保存，方便离开home组件时取消此事件监听\r\n      // this.itemImgListener = () => { refresh() }\r\n    // this.$bus.$on('itemImageLoad',() => {\r\n      // this.$refs.scroll.refresh()\r\n      // refresh() // 此处是闭包，局部变量不会被销毁\r\n    // })\r\n      // this.$bus.$on('itemImageLoad', this.itemImgListener)\r\n  },\r\n  methods: {\r\n    // 事件监听相关方法\r\n    // debounce(func,delay){ 封装\r\n    //   let timer = null // 此处也是局部变量，但下面形成了闭包，此局部变量就不会被销毁\r\n    //   return function(...args){ // 可让func函数传多个参数\r\n    //     if(timer) clearTimeout(timer) // 如果上一个定时器未执行完直接取消执行，减少对服务器的请求\r\n    //     timer = setTimeout(()=>{\r\n    //       func.apply(this,args) // 调用func函数，接收args作为参数\r\n    //     },delay)\r\n    //   }\r\n    // },\r\n    tabClick (index) {\r\n      switch (index) {\r\n        case 0:\r\n          this.currentType = 'pop'\r\n          break\r\n        case 1:\r\n          this.currentType = 'new'\r\n          break\r\n        case 2:\r\n          this.currentType= 'sell'\r\n          break\r\n      }\r\n      this.$refs.tabControl1.currentIndex = index\r\n      this.$refs.tabControl2.currentIndex = index\r\n    },\r\n    backTop () {\r\n      // this.$refs.scroll 可拿到scroll组件中的所有数据\r\n      // this.$refs.scroll.scroll.scrollTo(0,0,1000)\r\n      this.$refs.scroll.scrollTo(0,0) /* 封装之后 */\r\n    },\r\n    contentScroll(position) {\r\n      // console.log(position.y)\r\n        // this.showTop = (-position.y) > 1000  绝对值Math.abs\r\n        this.showTop = Math.abs(position.y) > 1000\r\n        // 2.设置吸顶效果\r\n        this.isTabFixed = (-position.y) > this.tabOffsetTop\r\n    },\r\n    loadMore(){\r\n      this.getHomeGoods(this.currentType)\r\n      // this.$refs.scroll.finishPullUp() 在这里完成上拉加载更多的话，以后每次再请求数据都还要再写\r\n    },\r\n    swiperImageLoad () {\r\n      // 2.获取tabOffsetTop的offsetTop\r\n    // console.log(this.$refs.tabControl.$el.offsetTop); \r\n    this.tabOffsetTop = this.$refs.tabControl2.$el.offsetTop\r\n    },\r\n    // 网络请求相关方法\r\n    getHomeMultidata () {\r\n      getHomeMultidata().then(res => {\r\n    //   console.log(res)\r\n    // this.result = res\r\n    this.banners = res.data.banner.list\r\n    this.recommends = res.data.recommend.list\r\n    })\r\n    },\r\n    getHomeGoods (type) {\r\n      const page = this.goods[type].page + 1\r\n      getHomeGoods(type, page).then(res => {\r\n      this.goods[type].list.push(...res.data.list)\r\n      this.goods[type].page += 1  /* 更新data中的页码 */\r\n      this.$refs.scroll.finishPullUp() // 调用方法，多次上拉加载更多\r\n    })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 加上scoped，表示当前的样式只作用于当前组件 */\r\n#home{\r\n  /* padding: 44px 0 64px; */\r\n  /* vh viewport height 视口高度，100vh就是整个视口高度，50vh是50%的高度 */\r\n  height: 100vh;\r\n  position: relative;\r\n}\r\n.home-nav {\r\n    background-color: var(--color-tint);\r\n    color: #fff;\r\n    /* position: fixed;\r\n    right: 0;\r\n    left: 0;\r\n    top: 0;\r\n    z-index: 9; */\r\n    /* position: relative; 下面加了overflow，这里就不用设置了\r\n    z-index: 9; */\r\n}\r\n/* .tab-control {\r\n  position: sticky;\r\n  top: 44px;\r\n  z-index: 9;\r\n} */\r\n.content {\r\n  /* 方法一：计算\r\n  height: calc(100% - 98px); \r\n  overflow:hidden;\r\n  margin-top:44px*/\r\n  overflow: hidden;\r\n  position: absolute;\r\n  top: 44px;\r\n  bottom: 49px;\r\n  left: 0;\r\n  right: 0;\r\n}\r\n.tab-control {\r\n  position: relative;\r\n  z-index: 9;\r\n}\r\n</style>\r\n"]}]}